# QR DINE - Complete Session Flow Specification

## Document Info
- **Version**: 1.0
- **Created**: January 25, 2026
- **Status**: APPROVED
- **Related**: PROJECT-SPEC.md Section to be added

---

## Table of Contents
1. [Flow Overview](#1-flow-overview)
2. [QR Scan & Assistance Timer](#2-qr-scan--assistance-timer)
3. [Session Lifecycle](#3-session-lifecycle)
4. [Item-Level Time Tracking](#4-item-level-time-tracking)
5. [OTP Management](#5-otp-management)
6. [Table Cleaning Flow](#6-table-cleaning-flow)
7. [Table Duration & Alerts](#7-table-duration--alerts)
8. [Dashboard Views](#8-dashboard-views)
9. [Database Schema Updates](#9-database-schema-updates)
10. [API Endpoints](#10-api-endpoints)
11. [Notification Templates](#11-notification-templates)
12. [Settings & Configuration](#12-settings--configuration)

---

## 1. Flow Overview

### Complete Guest Session Timeline

```
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
                         COMPLETE SESSION FLOW TIMELINE
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

    GUEST ARRIVES              QR SCAN              OTP ENTRY            SESSION START
         â”‚                        â”‚                     â”‚                      â”‚
         â–¼                        â–¼                     â–¼                      â–¼
    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”              â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”          â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”           â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”
    â”‚ Sits at â”‚              â”‚ Scans   â”‚          â”‚ Enters  â”‚           â”‚ Session â”‚
    â”‚ Table 5 â”‚â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–¶â”‚ QR Code â”‚â”€â”€â”€â”€â”€â”€â”€â”€â”€â–¶â”‚   OTP   â”‚â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–¶â”‚ Started â”‚
    â”‚         â”‚              â”‚         â”‚          â”‚         â”‚           â”‚         â”‚
    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜              â””â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”˜          â””â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”˜           â””â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”˜
      2:55 PM                 2:56 PM              3:00 PM               3:00 PM
                                  â”‚                    â”‚                      â”‚
                                  â–¼                    â”‚                      â”‚
                         â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”            â”‚                      â”‚
                         â”‚ â±ï¸ 2-min Timer â”‚            â”‚                      â”‚
                         â”‚    Started    â”‚            â”‚                      â”‚
                         â””â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”˜            â”‚                      â”‚
                                 â”‚                    â”‚                      â”‚
                    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”       â”‚                      â”‚
                    â–¼                         â–¼       â”‚                      â”‚
            [No OTP in 2 min]         [OTP Entered]   â”‚                      â”‚
                    â”‚                         â”‚       â”‚                      â”‚
                    â–¼                         â–¼       â–¼                      â”‚
           â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”          â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                   â”‚
           â”‚ ğŸ”” NOTIFY     â”‚          â”‚ â±ï¸ 5-min Timer  â”‚                   â”‚
           â”‚ "Needs Help"  â”‚          â”‚ (No order yet)  â”‚                   â”‚
           â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜          â””â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”˜                   â”‚
                                               â”‚                            â”‚
                                  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”               â”‚
                                  â–¼                         â–¼               â”‚
                          [No Order in 5 min]        [Order Placed]         â”‚
                                  â”‚                         â”‚               â”‚
                                  â–¼                         â”‚               â”‚
                         â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                  â”‚               â”‚
                         â”‚ ğŸ”” NOTIFY     â”‚                  â”‚               â”‚
                         â”‚ "May need    â”‚                  â”‚               â”‚
                         â”‚  assistance" â”‚                  â”‚               â”‚
                         â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                  â”‚               â”‚
                                                           â”‚               â”‚
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

      ORDER FLOW                 KITCHEN                  SERVICE              BILL
         â”‚                          â”‚                        â”‚                   â”‚
         â–¼                          â–¼                        â–¼                   â–¼
    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”              â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”          â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”     â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”
    â”‚ Guest   â”‚              â”‚   Kitchen   â”‚          â”‚   Waiter    â”‚     â”‚ Cashier â”‚
    â”‚ Orders  â”‚â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–¶â”‚  Prepares   â”‚â”€â”€â”€â”€â”€â”€â”€â”€â”€â–¶â”‚   Serves    â”‚â”€â”€â”€â”€â–¶â”‚  Bills  â”‚
    â”‚ (Cart)  â”‚              â”‚   Items     â”‚          â”‚   Items     â”‚     â”‚         â”‚
    â””â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”˜              â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”˜          â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”˜     â””â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”˜
      3:02 PM                   3:05-3:25 PM            3:15-3:28 PM        4:02 PM
         â”‚                          â”‚                        â”‚                   â”‚
         â”‚                          â”‚                        â”‚                   â”‚
    â”Œâ”€â”€â”€â”€â”´â”€â”€â”€â”€â”              â”Œâ”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”          â”Œâ”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”     â”Œâ”€â”€â”€â”€â”´â”€â”€â”€â”€â”
    â”‚ Track:  â”‚              â”‚ Track:      â”‚          â”‚ Track:      â”‚     â”‚ Shows:  â”‚
    â”‚ ordered â”‚              â”‚ preparing_atâ”‚          â”‚ served_at   â”‚     â”‚ served  â”‚
    â”‚ _at     â”‚              â”‚ ready_at    â”‚          â”‚ served_by   â”‚     â”‚ times   â”‚
    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜              â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜          â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜     â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

     PAYMENT                SESSION END              CLEANING              READY
         â”‚                      â”‚                       â”‚                    â”‚
         â–¼                      â–¼                       â–¼                    â–¼
    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”           â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”          â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”        â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”
    â”‚ Payment â”‚           â”‚  Session  â”‚          â”‚  Waiter   â”‚        â”‚  Table  â”‚
    â”‚ Completeâ”‚â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–¶â”‚   Ends    â”‚â”€â”€â”€â”€â”€â”€â”€â”€â”€â–¶â”‚  Cleans   â”‚â”€â”€â”€â”€â”€â”€â”€â–¶â”‚Availableâ”‚
    â”‚         â”‚           â”‚           â”‚          â”‚           â”‚        â”‚         â”‚
    â””â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”˜           â””â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”˜          â””â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”˜        â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
      4:05 PM               4:05 PM                4:08 PM             4:08 PM
         â”‚                      â”‚                       â”‚
         â”‚                      â”‚                       â”‚
    â”Œâ”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”
    â”‚ AUTOMATIC ACTIONS:                                    â”‚
    â”‚ â€¢ OTP changed (new: 847)                             â”‚
    â”‚ â€¢ Table status â†’ CLEANING                            â”‚
    â”‚ â€¢ Notify waiter for cleaning                         â”‚
    â”‚ â€¢ Voice messages deleted                             â”‚
    â”‚ â€¢ Session marked COMPLETED                           â”‚
    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
```

---

## 2. QR Scan & Assistance Timer

### 2.1 Flow Logic

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                        QR SCAN ASSISTANCE SYSTEM                                â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                                                 â”‚
â”‚  TRIGGER: Guest scans QR code (page load)                                      â”‚
â”‚                                                                                 â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚
â”‚  â”‚  API Call: POST /api/guest/qr-scan                                      â”‚   â”‚
â”‚  â”‚  Body: { table_id, device_fingerprint, timestamp }                      â”‚   â”‚
â”‚  â”‚                                                                          â”‚   â”‚
â”‚  â”‚  Server Actions:                                                         â”‚   â”‚
â”‚  â”‚  1. Create QRScanEvent record                                           â”‚   â”‚
â”‚  â”‚  2. Start assistance timer (configurable, default: 2 min)               â”‚   â”‚
â”‚  â”‚  3. Return table info + OTP prompt                                      â”‚   â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚
â”‚                                                                                 â”‚
â”‚  CASE 1: Guest doesn't enter OTP within timer                                  â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚
â”‚  â”‚  Background Job checks QRScanEvent records                              â”‚   â”‚
â”‚  â”‚  If: scan_time + timer_duration < now() AND otp_entered = false        â”‚   â”‚
â”‚  â”‚  Then: Send notification to waiter                                      â”‚   â”‚
â”‚  â”‚                                                                          â”‚   â”‚
â”‚  â”‚  Notification Type: GUEST_NEEDS_OTP_HELP                                â”‚   â”‚
â”‚  â”‚  Message: "Table {N} - Guest scanned QR but hasn't entered OTP"        â”‚   â”‚
â”‚  â”‚  Priority: MEDIUM                                                        â”‚   â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚
â”‚                                                                                 â”‚
â”‚  CASE 2: Guest enters OTP but doesn't order                                    â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚
â”‚  â”‚  On successful OTP entry:                                                â”‚   â”‚
â”‚  â”‚  1. Mark QRScanEvent.otp_entered = true                                 â”‚   â”‚
â”‚  â”‚  2. Start new timer (configurable, default: 5 min)                      â”‚   â”‚
â”‚  â”‚                                                                          â”‚   â”‚
â”‚  â”‚  If: otp_time + order_timer < now() AND orders_count = 0               â”‚   â”‚
â”‚  â”‚  Then: Send notification to waiter                                      â”‚   â”‚
â”‚  â”‚                                                                          â”‚   â”‚
â”‚  â”‚  Notification Type: GUEST_BROWSING_NO_ORDER                             â”‚   â”‚
â”‚  â”‚  Message: "Table {N} - Guest browsing menu, may need assistance"       â”‚   â”‚
â”‚  â”‚  Priority: LOW                                                           â”‚   â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚
â”‚                                                                                 â”‚
â”‚  CASE 3: Guest completes order (Normal flow)                                   â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚
â”‚  â”‚  On order placement:                                                     â”‚   â”‚
â”‚  â”‚  1. Cancel all pending assistance timers                                â”‚   â”‚
â”‚  â”‚  2. Mark QRScanEvent.order_placed = true                                â”‚   â”‚
â”‚  â”‚  3. Continue normal order flow                                          â”‚   â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚
â”‚                                                                                 â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### 2.2 Notification Messages (Case-Specific)

| Case | Notification Type | Message | Priority | Icon |
|------|------------------|---------|----------|------|
| No OTP entered | `GUEST_NEEDS_OTP_HELP` | "Table {N} - Guest scanned QR but hasn't entered OTP ({X} min ago)" | MEDIUM | ğŸ†˜ |
| OTP entered, no order | `GUEST_BROWSING_NO_ORDER` | "Table {N} - Guest browsing menu, may need assistance" | LOW | ğŸ‘€ |
| Multiple failed OTP | `GUEST_OTP_FAILED` | "Table {N} - Guest entered wrong OTP {X} times" | HIGH | âš ï¸ |

### 2.3 Database Schema for QR Scan Tracking

```prisma
model QRScanEvent {
  id                  String    @id @default(cuid())
  restaurant_id       String
  table_id            String
  
  // Tracking
  scanned_at          DateTime  @default(now())
  device_fingerprint  String?   // Browser fingerprint
  ip_address          String?
  user_agent          String?
  
  // Status flags
  otp_entered         Boolean   @default(false)
  otp_entered_at      DateTime?
  otp_attempts        Int       @default(0)
  
  order_placed        Boolean   @default(false)
  order_placed_at     DateTime?
  
  // Notifications sent
  otp_help_notified   Boolean   @default(false)
  otp_help_notified_at DateTime?
  
  browse_help_notified Boolean  @default(false)
  browse_help_notified_at DateTime?
  
  // Session created (if successful)
  session_id          String?
  
  // Relations
  restaurant          Restaurant @relation(fields: [restaurant_id], references: [id])
  table               Table      @relation(fields: [table_id], references: [id])
  session             TableSession? @relation(fields: [session_id], references: [id])
  
  @@index([restaurant_id, table_id, scanned_at])
  @@index([otp_entered, scanned_at])
}
```

---

## 3. Session Lifecycle

### 3.1 Session States

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                           SESSION STATE MACHINE                                 â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                                                 â”‚
â”‚                              â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                                   â”‚
â”‚                              â”‚   CREATED   â”‚                                   â”‚
â”‚                              â”‚ (OTP Valid) â”‚                                   â”‚
â”‚                              â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”˜                                   â”‚
â”‚                                     â”‚                                          â”‚
â”‚                         â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                              â”‚
â”‚                         â–¼                       â–¼                              â”‚
â”‚                  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”         â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                       â”‚
â”‚                  â”‚   ACTIVE    â”‚         â”‚  ABANDONED  â”‚                       â”‚
â”‚                  â”‚(Guest Count)â”‚         â”‚ (No action  â”‚                       â”‚
â”‚                  â”‚   Entered   â”‚         â”‚  for 30min) â”‚                       â”‚
â”‚                  â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”˜         â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                       â”‚
â”‚                         â”‚                                                      â”‚
â”‚                         â–¼                                                      â”‚
â”‚                  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                                               â”‚
â”‚                  â”‚  ORDERING   â”‚â—„â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                             â”‚
â”‚                  â”‚ (Has items  â”‚                 â”‚                             â”‚
â”‚                  â”‚  in cart)   â”‚                 â”‚                             â”‚
â”‚                  â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”˜                 â”‚                             â”‚
â”‚                         â”‚                        â”‚                             â”‚
â”‚                         â–¼                        â”‚                             â”‚
â”‚                  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                 â”‚                             â”‚
â”‚                  â”‚   DINING    â”‚â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                             â”‚
â”‚                  â”‚(Order being â”‚  (Additional orders)                          â”‚
â”‚                  â”‚  served)    â”‚                                               â”‚
â”‚                  â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”˜                                               â”‚
â”‚                         â”‚                                                      â”‚
â”‚                         â–¼                                                      â”‚
â”‚                  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                                               â”‚
â”‚                  â”‚    BILL     â”‚                                               â”‚
â”‚                  â”‚  REQUESTED  â”‚                                               â”‚
â”‚                  â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”˜                                               â”‚
â”‚                         â”‚                                                      â”‚
â”‚                         â–¼                                                      â”‚
â”‚                  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                                               â”‚
â”‚                  â”‚  COMPLETED  â”‚                                               â”‚
â”‚                  â”‚(Payment Done)â”‚                                               â”‚
â”‚                  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                                               â”‚
â”‚                                                                                 â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### 3.2 Session Data Model

```prisma
model TableSession {
  id                  String          @id @default(cuid())
  restaurant_id       String
  table_id            String
  
  // Session Info
  session_number      Int             // Daily sequence: 1, 2, 3...
  status              SessionStatus   @default(CREATED)
  
  // Guest Info (STAFF ONLY CAN SET)
  guest_count         Int?
  guest_count_set_by  String?         // Staff ID
  guest_count_set_at  DateTime?
  
  // Timing
  created_at          DateTime        @default(now())
  started_at          DateTime?       // When guest count entered
  first_order_at      DateTime?       // First order placed
  last_order_at       DateTime?       // Last order placed
  bill_requested_at   DateTime?
  ended_at            DateTime?       // Payment completed
  
  // Billing
  bill_id             String?
  total_amount        Decimal?
  
  // OTP used for this session
  otp_used            String
  
  // Relations
  restaurant          Restaurant      @relation(...)
  table               Table           @relation(...)
  orders              Order[]
  voice_messages      VoiceMessage[]
  qr_scan_events      QRScanEvent[]
  guest_count_history GuestCountHistory[]
  
  @@index([restaurant_id, table_id, status])
  @@index([restaurant_id, created_at])
}

enum SessionStatus {
  CREATED           // OTP verified, waiting for guest count
  ACTIVE            // Guest count entered, session active
  ORDERING          // Has items in cart
  DINING            // Orders being served
  BILL_REQUESTED    // Guest requested bill
  COMPLETED         // Payment done, session ended
  ABANDONED         // No activity, auto-closed
}

// Track guest count changes (audit)
model GuestCountHistory {
  id            String        @id @default(cuid())
  session_id    String
  previous_count Int?
  new_count     Int
  changed_by    String        // Staff ID
  changed_at    DateTime      @default(now())
  reason        String?       // "Initial", "Guest added", "Guest left"
  
  session       TableSession  @relation(...)
  staff         User          @relation(...)
}
```

---

## 4. Item-Level Time Tracking

### 4.1 Order Item Timeline

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                         ORDER ITEM TIMELINE TRACKING                            â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                                                 â”‚
â”‚  ITEM: Chicken Momo (2x)                                                       â”‚
â”‚  ORDER: #ORD-0042                                                              â”‚
â”‚                                                                                 â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”      â”‚
â”‚  â”‚ ORDERED â”‚â”€â”€â”€â–¶â”‚CONFIRMEDâ”‚â”€â”€â”€â–¶â”‚PREPARINGâ”‚â”€â”€â”€â–¶â”‚  READY  â”‚â”€â”€â”€â–¶â”‚ SERVED  â”‚      â”‚
â”‚  â””â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”˜    â””â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”˜    â””â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”˜    â””â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”˜    â””â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”˜      â”‚
â”‚       â”‚              â”‚              â”‚              â”‚              â”‚            â”‚
â”‚    3:02 PM        3:03 PM       3:05 PM        3:12 PM        3:15 PM         â”‚
â”‚       â”‚              â”‚              â”‚              â”‚              â”‚            â”‚
â”‚       â”‚              â”‚              â”‚              â”‚              â”‚            â”‚
â”‚  â”Œâ”€â”€â”€â”€â”´â”€â”€â”€â”€â”    â”Œâ”€â”€â”€â”€â”´â”€â”€â”€â”€â”    â”Œâ”€â”€â”€â”€â”´â”€â”€â”€â”€â”    â”Œâ”€â”€â”€â”€â”´â”€â”€â”€â”€â”    â”Œâ”€â”€â”€â”€â”´â”€â”€â”€â”€â”      â”‚
â”‚  â”‚ Guest   â”‚    â”‚ Waiter  â”‚    â”‚ Kitchen â”‚    â”‚ Kitchen â”‚    â”‚ Waiter  â”‚      â”‚
â”‚  â”‚ placed  â”‚    â”‚ confirmsâ”‚    â”‚ starts  â”‚    â”‚ marks   â”‚    â”‚ serves  â”‚      â”‚
â”‚  â”‚ order   â”‚    â”‚ order   â”‚    â”‚ cooking â”‚    â”‚ ready   â”‚    â”‚ to guestâ”‚      â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜      â”‚
â”‚                                                                                 â”‚
â”‚  DURATIONS:                                                                    â”‚
â”‚  â€¢ Confirmation time: 1 min (3:02 â†’ 3:03)                                     â”‚
â”‚  â€¢ Kitchen wait time: 2 min (3:03 â†’ 3:05)                                     â”‚
â”‚  â€¢ Preparation time:  7 min (3:05 â†’ 3:12)                                     â”‚
â”‚  â€¢ Pickup wait time:  3 min (3:12 â†’ 3:15)                                     â”‚
â”‚  â€¢ TOTAL time:       13 min (3:02 â†’ 3:15)                                     â”‚
â”‚                                                                                 â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### 4.2 Database Schema for Item Tracking

```prisma
model OrderItem {
  id                  String            @id @default(cuid())
  order_id            String
  menu_item_id        String
  
  // Item Details
  quantity            Int
  unit_price          Decimal           @db.Decimal(10, 2)
  total_price         Decimal           @db.Decimal(10, 2)
  notes               String?
  
  // Variant/Addon
  variant_id          String?
  addons              Json?             // [{addon_id, quantity, price}]
  
  // STATUS
  status              OrderItemStatus   @default(PENDING)
  
  // â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
  // TIME TRACKING (CRITICAL)
  // â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
  ordered_at          DateTime          @default(now())
  confirmed_at        DateTime?         // Waiter confirmed
  confirmed_by        String?           // Staff ID
  
  preparing_at        DateTime?         // Kitchen started
  preparing_by        String?           // Kitchen staff ID
  
  ready_at            DateTime?         // Kitchen completed
  ready_by            String?           // Kitchen staff ID
  
  served_at           DateTime?         // Waiter delivered to table
  served_by           String?           // Waiter ID
  
  cancelled_at        DateTime?
  cancelled_by        String?
  cancel_reason       String?
  // â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
  
  // Kitchen Station
  station             KitchenStation?   @default(HOT_KITCHEN)
  
  // Relations
  order               Order             @relation(...)
  menu_item           MenuItem          @relation(...)
  
  @@index([order_id, status])
  @@index([status, station])
}

enum OrderItemStatus {
  PENDING       // Just ordered, waiting confirmation
  CONFIRMED     // Waiter confirmed, sent to kitchen
  PREPARING     // Kitchen is cooking
  READY         // Ready for pickup
  SERVED        // Delivered to guest
  CANCELLED     // Cancelled
}

enum KitchenStation {
  HOT_KITCHEN   // Main cooking
  COLD_KITCHEN  // Salads, cold items
  GRILL         // Grilled items
  FRY           // Fried items
  BEVERAGES     // Drinks
  DESSERT       // Desserts
  BAR           // Alcoholic drinks
}
```

### 4.3 Waiter "Mark as Served" Flow

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                          WAITER SERVES ITEM FLOW                                â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                                                 â”‚
â”‚  KITCHEN DISPLAY                        WAITER APP                              â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”       â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”         â”‚
â”‚  â”‚  #ORD-0042 - Table 5        â”‚       â”‚  ğŸ”” NOTIFICATION             â”‚         â”‚
â”‚  â”‚                             â”‚       â”‚                             â”‚         â”‚
â”‚  â”‚  2x Chicken Momo    [READY] â”‚â”€â”€â”€â”€â”€â”€â–¶â”‚  Order Ready for Pickup    â”‚         â”‚
â”‚  â”‚                             â”‚       â”‚  Table 5 - 2x Chicken Momo â”‚         â”‚
â”‚  â”‚  [ Mark All Picked Up ]     â”‚       â”‚                             â”‚         â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜       â”‚  [ Pick Up ]                â”‚         â”‚
â”‚                                        â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜         â”‚
â”‚                                                       â”‚                        â”‚
â”‚                                                       â–¼                        â”‚
â”‚                                        â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”         â”‚
â”‚                                        â”‚  WAITER PICKS UP ITEM       â”‚         â”‚
â”‚                                        â”‚  (Walks to table)           â”‚         â”‚
â”‚                                        â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜         â”‚
â”‚                                                       â”‚                        â”‚
â”‚                                                       â–¼                        â”‚
â”‚                                        â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”         â”‚
â”‚                                        â”‚  WAITER MARKS "SERVED"      â”‚         â”‚
â”‚                                        â”‚                             â”‚         â”‚
â”‚                                        â”‚  Table 5 - Items to Serve:  â”‚         â”‚
â”‚                                        â”‚  â˜ 2x Chicken Momo          â”‚         â”‚
â”‚                                        â”‚  â˜ 1x Coke                  â”‚         â”‚
â”‚                                        â”‚                             â”‚         â”‚
â”‚                                        â”‚  [ âœ“ Mark Selected Served ] â”‚         â”‚
â”‚                                        â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜         â”‚
â”‚                                                       â”‚                        â”‚
â”‚                                                       â–¼                        â”‚
â”‚                                        â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”         â”‚
â”‚                                        â”‚  SYSTEM RECORDS:            â”‚         â”‚
â”‚                                        â”‚  â€¢ served_at = NOW()        â”‚         â”‚
â”‚                                        â”‚  â€¢ served_by = waiter_id    â”‚         â”‚
â”‚                                        â”‚  â€¢ status = SERVED          â”‚         â”‚
â”‚                                        â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜         â”‚
â”‚                                                                                 â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### 4.4 Bill Display (Customer vs Internal)

**CUSTOMER BILL (Printed):**
```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                    QR DINE RESTAURANT                       â”‚
â”‚                   123 Main Street, KTM                      â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚  Bill No: #245                     Date: 2026-01-25        â”‚
â”‚  Table: 5                          Time: 4:02 PM           â”‚
â”‚  Guests: 4                         Server: Ram             â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚  Item                    Qty    Rate    Amount    Served   â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚  Chicken Momo             2    Rs.250   Rs.500    3:15 PM  â”‚
â”‚  Veg Fried Rice           1    Rs.350   Rs.350    3:20 PM  â”‚
â”‚  Coke                     1    Rs.100   Rs.100    3:05 PM  â”‚
â”‚  Chocolate Brownie        1    Rs.250   Rs.250    3:28 PM  â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚  Subtotal:                              Rs.1,200           â”‚
â”‚  Service Charge (10%):                  Rs.120             â”‚
â”‚  VAT (13%):                             Rs.172             â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚  GRAND TOTAL:                           Rs.1,492           â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚  Session: 3:00 PM - 4:02 PM (1h 2m)                       â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                   Thank you for dining!                    â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

NOTE: Only "Served" time shown on customer bill
```

**INTERNAL VIEW (Dashboard/Reports):**
```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  ORDER #ORD-0042 - Table 5                                    INTERNAL VIEW    â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                                                 â”‚
â”‚  Item              Qty   Ordered   Confirmed  Preparing   Ready    Served      â”‚
â”‚  â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€  â”‚
â”‚  Chicken Momo       2    3:02 PM   3:03 PM    3:05 PM    3:12 PM  3:15 PM     â”‚
â”‚                          (1 min)   (2 min)    (7 min)    (3 min)              â”‚
â”‚                                                                                 â”‚
â”‚  Veg Fried Rice     1    3:02 PM   3:03 PM    3:06 PM    3:18 PM  3:20 PM     â”‚
â”‚                          (1 min)   (3 min)    (12 min)   (2 min)              â”‚
â”‚                                                                                 â”‚
â”‚  Coke               1    3:02 PM   3:03 PM    3:03 PM    3:04 PM  3:05 PM     â”‚
â”‚                          (0 min)   (0 min)    (1 min)    (1 min)              â”‚
â”‚                                                                                 â”‚
â”‚  Chocolate Brownie  1    3:02 PM   3:03 PM    3:20 PM    3:25 PM  3:28 PM     â”‚
â”‚                          (1 min)   (17 min)   (5 min)    (3 min)              â”‚
â”‚                                                                                 â”‚
â”‚  â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€  â”‚
â”‚  AVERAGES:                                                                      â”‚
â”‚  â€¢ Avg Confirmation: 0.75 min                                                  â”‚
â”‚  â€¢ Avg Kitchen Wait: 5.5 min                                                   â”‚
â”‚  â€¢ Avg Prep Time: 6.25 min                                                     â”‚
â”‚  â€¢ Avg Pickup Wait: 2.25 min                                                   â”‚
â”‚  â€¢ Avg Total: 13.5 min                                                         â”‚
â”‚                                                                                 â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

NOTE: Order number (#ORD-0042) shown internally, not on customer bill
```

---

## 5. OTP Management

### 5.1 OTP Lifecycle

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                              OTP LIFECYCLE                                      â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                                                 â”‚
â”‚  TABLE CREATED                    SESSION ENDS                   NEW OTP       â”‚
â”‚       â”‚                                â”‚                            â”‚          â”‚
â”‚       â–¼                                â–¼                            â–¼          â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”    SESSION 1         â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”                  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”‚
â”‚  â”‚ OTP: 523â”‚â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–¶ â”‚ Payment â”‚â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–¶â”‚ OTP: 847â”‚    â”‚
â”‚  â”‚ Active  â”‚    (3:00-4:05 PM)   â”‚ Completeâ”‚  Auto-generate  â”‚ Active  â”‚    â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                      â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â”‚
â”‚                                                                                 â”‚
â”‚  WHY CHANGE OTP ON PAYMENT?                                                    â”‚
â”‚  â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€  â”‚
â”‚  1. Previous guest can't scan again and access table                          â”‚
â”‚  2. Fresh start for next guest                                                 â”‚
â”‚  3. Security - prevents session hijacking                                      â”‚
â”‚  4. Clean audit trail per session                                             â”‚
â”‚                                                                                 â”‚
â”‚  OTP CHANGE TRIGGER:                                                           â”‚
â”‚  â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€  â”‚
â”‚  âœ… Payment completed                                                          â”‚
â”‚  âœ… Session manually ended by staff                                            â”‚
â”‚  âœ… Session abandoned (auto-close after 30 min no activity)                   â”‚
â”‚  âŒ NOT on bill generation                                                     â”‚
â”‚  âŒ NOT on table cleaned                                                       â”‚
â”‚                                                                                 â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### 5.2 OTP History Tracking

```prisma
model OTPHistory {
  id              String    @id @default(cuid())
  restaurant_id   String
  table_id        String
  
  otp             String    // The OTP value
  
  // Lifecycle
  generated_at    DateTime  @default(now())
  generated_by    String?   // Staff ID or "SYSTEM"
  generation_reason String  // "TABLE_CREATED", "SESSION_ENDED", "MANUAL_RESET"
  
  used_at         DateTime? // When session started with this OTP
  session_id      String?   // Session that used this OTP
  
  expired_at      DateTime? // When replaced by new OTP
  expired_reason  String?   // "SESSION_ENDED", "MANUAL_RESET"
  
  // Relations
  restaurant      Restaurant @relation(...)
  table           Table      @relation(...)
  session         TableSession? @relation(...)
  
  @@index([restaurant_id, table_id, generated_at])
  @@index([otp, table_id])
}
```

### 5.3 OTP Change Implementation

```typescript
// services/otp.service.ts

export async function endSessionAndChangeOTP(sessionId: string) {
  return await prisma.$transaction(async (tx) => {
    
    // 1. Get session details
    const session = await tx.tableSession.findUnique({
      where: { id: sessionId },
      include: { table: true }
    });
    
    if (!session) throw new Error('Session not found');
    
    // 2. Mark current OTP as expired
    await tx.oTPHistory.updateMany({
      where: {
        table_id: session.table_id,
        expired_at: null
      },
      data: {
        expired_at: new Date(),
        expired_reason: 'SESSION_ENDED'
      }
    });
    
    // 3. Generate new OTP
    const newOTP = generateSecureOTP(); // 3-digit random
    
    // 4. Create new OTP history record
    await tx.oTPHistory.create({
      data: {
        restaurant_id: session.restaurant_id,
        table_id: session.table_id,
        otp: newOTP,
        generated_by: 'SYSTEM',
        generation_reason: 'SESSION_ENDED'
      }
    });
    
    // 5. Update table with new OTP
    await tx.table.update({
      where: { id: session.table_id },
      data: {
        current_otp: newOTP,
        otp_generated_at: new Date(),
        status: 'CLEANING'
      }
    });
    
    // 6. Mark session as completed
    await tx.tableSession.update({
      where: { id: sessionId },
      data: {
        status: 'COMPLETED',
        ended_at: new Date()
      }
    });
    
    // 7. Delete voice messages for this session
    const voiceMessages = await tx.voiceMessage.findMany({
      where: { session_id: sessionId }
    });
    
    // Delete audio files from storage
    for (const vm of voiceMessages) {
      await deleteAudioFile(vm.audio_url);
    }
    
    await tx.voiceMessage.deleteMany({
      where: { session_id: sessionId }
    });
    
    // 8. Send cleaning notification
    await sendNotification({
      type: 'TABLE_READY_FOR_CLEANING',
      restaurant_id: session.restaurant_id,
      table_id: session.table_id,
      data: {
        table_number: session.table.table_number,
        session_duration: calculateDuration(session.started_at, new Date()),
        guest_count: session.guest_count,
        total_amount: session.total_amount
      }
    });
    
    return { newOTP, tableId: session.table_id };
  });
}

function generateSecureOTP(): string {
  // Generate 3-digit OTP (100-999)
  return String(Math.floor(100 + Math.random() * 900));
}
```

---

## 6. Table Cleaning Flow

### 6.1 Cleaning Status Flow

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                           TABLE CLEANING FLOW                                   â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                                                 â”‚
â”‚  PAYMENT COMPLETE                                                               â”‚
â”‚        â”‚                                                                        â”‚
â”‚        â–¼                                                                        â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚
â”‚  â”‚  AUTOMATIC ACTIONS:                                                       â”‚ â”‚
â”‚  â”‚  1. Session status â†’ COMPLETED                                           â”‚ â”‚
â”‚  â”‚  2. Table status â†’ CLEANING                                              â”‚ â”‚
â”‚  â”‚  3. Generate new OTP                                                     â”‚ â”‚
â”‚  â”‚  4. Delete voice messages                                                â”‚ â”‚
â”‚  â”‚  5. Send notification to staff                                           â”‚ â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚
â”‚        â”‚                                                                        â”‚
â”‚        â–¼                                                                        â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚
â”‚  â”‚  ğŸ”” NOTIFICATION TO STAFF                                                â”‚   â”‚
â”‚  â”‚                                                                          â”‚   â”‚
â”‚  â”‚  Recipients: Assigned waiter, All waiters, Host (configurable)          â”‚   â”‚
â”‚  â”‚                                                                          â”‚   â”‚
â”‚  â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚   â”‚
â”‚  â”‚  â”‚  ğŸ§¹ Table 5 - Ready for Cleaning                                   â”‚ â”‚   â”‚
â”‚  â”‚  â”‚                                                                     â”‚ â”‚   â”‚
â”‚  â”‚  â”‚  Session: 3:00 PM - 4:05 PM (1h 5m)                               â”‚ â”‚   â”‚
â”‚  â”‚  â”‚  Guests: 4                                                         â”‚ â”‚   â”‚
â”‚  â”‚  â”‚  Bill: Rs.1,492                                                    â”‚ â”‚   â”‚
â”‚  â”‚  â”‚                                                                     â”‚ â”‚   â”‚
â”‚  â”‚  â”‚  [ Mark as Cleaned ]    [ Assign to Staff ]                       â”‚ â”‚   â”‚
â”‚  â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚   â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚
â”‚        â”‚                                                                        â”‚
â”‚        â”‚         â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”     â”‚
â”‚        â”‚         â”‚  â±ï¸ CLEANING TIME LIMIT ALERT (Optional)             â”‚     â”‚
â”‚        â”‚         â”‚                                                       â”‚     â”‚
â”‚        â”‚         â”‚  If table not cleaned within X minutes:              â”‚     â”‚
â”‚        â”‚         â”‚  â€¢ Show warning in dashboard                         â”‚     â”‚
â”‚        â”‚         â”‚  â€¢ Escalate to manager (configurable)                â”‚     â”‚
â”‚        â”‚         â”‚                                                       â”‚     â”‚
â”‚        â”‚         â”‚  Example: "Table 5 waiting for cleaning (15 min)" âš ï¸ â”‚     â”‚
â”‚        â”‚         â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜     â”‚
â”‚        â”‚                                                                        â”‚
â”‚        â–¼                                                                        â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚
â”‚  â”‚  STAFF MARKS TABLE CLEANED                                              â”‚   â”‚
â”‚  â”‚                                                                          â”‚   â”‚
â”‚  â”‚  Who can mark: Any staff (Waiter, Host, Manager, Cashier)              â”‚   â”‚
â”‚  â”‚                                                                          â”‚   â”‚
â”‚  â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚   â”‚
â”‚  â”‚  â”‚  Mark Table 5 as Cleaned?                                          â”‚ â”‚   â”‚
â”‚  â”‚  â”‚                                                                     â”‚ â”‚   â”‚
â”‚  â”‚  â”‚  Cleaning checklist (optional):                                    â”‚ â”‚   â”‚
â”‚  â”‚  â”‚  â˜‘ Table wiped                                                     â”‚ â”‚   â”‚
â”‚  â”‚  â”‚  â˜‘ Chairs arranged                                                 â”‚ â”‚   â”‚
â”‚  â”‚  â”‚  â˜‘ Floor checked                                                   â”‚ â”‚   â”‚
â”‚  â”‚  â”‚  â˜‘ Condiments restocked                                            â”‚ â”‚   â”‚
â”‚  â”‚  â”‚                                                                     â”‚ â”‚   â”‚
â”‚  â”‚  â”‚  [ Cancel ]    [ âœ“ Mark as Cleaned ]                              â”‚ â”‚   â”‚
â”‚  â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚   â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚
â”‚        â”‚                                                                        â”‚
â”‚        â–¼                                                                        â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚
â”‚  â”‚  TABLE STATUS â†’ AVAILABLE                                                 â”‚ â”‚
â”‚  â”‚  Ready for next guest!                                                   â”‚ â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚
â”‚                                                                                 â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### 6.2 Cleaning Record Schema

```prisma
model TableCleaningRecord {
  id              String    @id @default(cuid())
  restaurant_id   String
  table_id        String
  session_id      String?   // Previous session
  
  // Timing
  cleaning_requested_at DateTime @default(now())
  cleaned_at            DateTime?
  cleaning_duration     Int?      // Minutes taken
  
  // Staff
  cleaned_by      String?   // Staff ID
  
  // Checklist (optional)
  checklist       Json?     // {table_wiped: true, chairs: true, ...}
  
  // Alert tracking
  alert_sent_at   DateTime?
  escalated_at    DateTime?
  
  // Relations
  restaurant      Restaurant @relation(...)
  table           Table      @relation(...)
  session         TableSession? @relation(...)
  staff           User?      @relation(...)
  
  @@index([restaurant_id, cleaning_requested_at])
}
```

---

## 7. Table Duration & Alerts

### 7.1 Duration Display Rules

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                        TABLE DURATION DISPLAY RULES                             â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                                                 â”‚
â”‚  DURATION CALCULATION:                                                         â”‚
â”‚  â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€  â”‚
â”‚  Start time = session.started_at (when guest count entered)                    â”‚
â”‚  Current duration = NOW() - session.started_at                                 â”‚
â”‚                                                                                 â”‚
â”‚  COLOR CODING (Configurable):                                                  â”‚
â”‚  â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€  â”‚
â”‚                                                                                 â”‚
â”‚  Duration        Color       Meaning                                           â”‚
â”‚  â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ â”‚
â”‚  0-30 min        ğŸŸ¢ Green    Normal dining time                                â”‚
â”‚  30-60 min       ğŸŸ¡ Yellow   Getting longer                                    â”‚
â”‚  60-90 min       ğŸŸ  Orange   Long stay                                         â”‚
â”‚  90+ min         ğŸ”´ Red      Very long stay                                    â”‚
â”‚                                                                                 â”‚
â”‚  TABLE CARD EXAMPLES:                                                          â”‚
â”‚  â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€  â”‚
â”‚                                                                                 â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”           â”‚
â”‚  â”‚  Table 1    â”‚  â”‚  Table 5    â”‚  â”‚  Table 8    â”‚  â”‚  Table 12   â”‚           â”‚
â”‚  â”‚  ğŸŸ¡ OCCUPIEDâ”‚  â”‚  ğŸŸ¡ OCCUPIEDâ”‚  â”‚  ğŸŸ¡ OCCUPIEDâ”‚  â”‚  ğŸŸ¡ OCCUPIEDâ”‚           â”‚
â”‚  â”‚  ğŸ‘¥ 4       â”‚  â”‚  ğŸ‘¥ 2       â”‚  â”‚  ğŸ‘¥ 6       â”‚  â”‚  ğŸ‘¥ 3       â”‚           â”‚
â”‚  â”‚  â±ï¸ 15m ğŸŸ¢  â”‚  â”‚  â±ï¸ 45m ğŸŸ¡  â”‚  â”‚  â±ï¸ 1h 10mğŸŸ â”‚  â”‚  â±ï¸ 2h ğŸ”´   â”‚           â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜           â”‚
â”‚                                                                                 â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### 7.2 Long Stay Alert System

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                          LONG STAY ALERT SYSTEM                                 â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                                                 â”‚
â”‚  ALERT CONFIGURATION (Settings â†’ Table Management â†’ Alerts):                   â”‚
â”‚  â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€  â”‚
â”‚                                                                                 â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚
â”‚  â”‚  Long Stay Alerts                                          [Enabled âœ“] â”‚   â”‚
â”‚  â”‚                                                                         â”‚   â”‚
â”‚  â”‚  Send notification after table occupied for: [ 90 ] minutes            â”‚   â”‚
â”‚  â”‚                                                                         â”‚   â”‚
â”‚  â”‚  Notify:                                                                â”‚   â”‚
â”‚  â”‚  â˜‘ Assigned waiter                                                     â”‚   â”‚
â”‚  â”‚  â˜‘ Manager                                                             â”‚   â”‚
â”‚  â”‚  â˜ All waiters                                                         â”‚   â”‚
â”‚  â”‚                                                                         â”‚   â”‚
â”‚  â”‚  Repeat notification every: [ 30 ] minutes                             â”‚   â”‚
â”‚  â”‚                                                                         â”‚   â”‚
â”‚  â”‚  Message: "Table {N} occupied for {duration} - Check if OK"            â”‚   â”‚
â”‚  â”‚                                                                         â”‚   â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚
â”‚                                                                                 â”‚
â”‚  ALERT FLOW:                                                                   â”‚
â”‚  â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€  â”‚
â”‚                                                                                 â”‚
â”‚  Session starts at 3:00 PM                                                     â”‚
â”‚        â”‚                                                                        â”‚
â”‚        â”œâ”€â”€ 3:30 PM: Duration 30m â†’ Yellow color                                â”‚
â”‚        â”‚                                                                        â”‚
â”‚        â”œâ”€â”€ 4:00 PM: Duration 60m â†’ Orange color                                â”‚
â”‚        â”‚                                                                        â”‚
â”‚        â”œâ”€â”€ 4:30 PM: Duration 90m â†’ Red color + ğŸ”” NOTIFICATION                 â”‚
â”‚        â”‚            "Table 5 occupied for 1h 30m - Check if assistance needed" â”‚
â”‚        â”‚                                                                        â”‚
â”‚        â”œâ”€â”€ 5:00 PM: Duration 120m â†’ ğŸ”” REPEAT NOTIFICATION                     â”‚
â”‚        â”‚            "Table 5 still occupied (2h) - Please check"               â”‚
â”‚        â”‚                                                                        â”‚
â”‚        â””â”€â”€ ... continues every 30 min                                          â”‚
â”‚                                                                                 â”‚
â”‚  WAITER CAN:                                                                   â”‚
â”‚  â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€  â”‚
â”‚  â€¢ Dismiss alert (with reason: "Guest confirmed staying")                      â”‚
â”‚  â€¢ Snooze alert (30 min)                                                       â”‚
â”‚  â€¢ Request bill on behalf of guest                                             â”‚
â”‚                                                                                 â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## 8. Dashboard Views

### 8.1 Waiter Dashboard (Standard View)

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  ğŸ‘¤ Ram (Waiter)                              ğŸ”” 3     âš™ï¸    [Logout]          â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                                                 â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”                           â”‚
â”‚  â”‚ My      â”‚  â”‚ Pending â”‚  â”‚ Voice   â”‚  â”‚ Need    â”‚                           â”‚
â”‚  â”‚ Tables  â”‚  â”‚ Orders  â”‚  â”‚ Messagesâ”‚  â”‚ Assist  â”‚                           â”‚
â”‚  â”‚   8     â”‚  â”‚   2     â”‚  â”‚   1     â”‚  â”‚   1     â”‚                           â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                           â”‚
â”‚                                                                                 â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚  [All] [My Tables] [Needs Attention]        ğŸ” Search    [Grid â–£] [List â˜°]    â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                                                 â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚
â”‚  â”‚  Table 1      â”‚  â”‚  Table 2      â”‚  â”‚  Table 3      â”‚  â”‚  Table 4      â”‚   â”‚
â”‚  â”‚  ğŸŸ¢ AVAILABLE â”‚  â”‚  ğŸŸ¡ OCCUPIED  â”‚  â”‚  ğŸŸ¡ OCCUPIED  â”‚  â”‚  ğŸ”´ BILL REQ  â”‚   â”‚
â”‚  â”‚               â”‚  â”‚  ğŸ‘¥ 4         â”‚  â”‚  ğŸ‘¥ 2         â”‚  â”‚  ğŸ‘¥ 6         â”‚   â”‚
â”‚  â”‚               â”‚  â”‚  â±ï¸ 25m ğŸŸ¢    â”‚  â”‚  â±ï¸ 1h 5m ğŸŸ   â”‚  â”‚  â±ï¸ 45m ğŸŸ¡    â”‚   â”‚
â”‚  â”‚               â”‚  â”‚  ğŸ“‹ 2 orders  â”‚  â”‚  ğŸ“‹ 1 order   â”‚  â”‚  ğŸ’° Rs.3.2K   â”‚   â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚
â”‚                                                                                 â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚
â”‚  â”‚  Table 5      â”‚  â”‚  Table 6      â”‚  â”‚  Table 7      â”‚  â”‚  Table 8      â”‚   â”‚
â”‚  â”‚  ğŸŸ£ CLEANING  â”‚  â”‚  ğŸŸ¢ AVAILABLE â”‚  â”‚  ğŸŸ  ATTENTION â”‚  â”‚  ğŸŸ¡ OCCUPIED  â”‚   â”‚
â”‚  â”‚               â”‚  â”‚               â”‚  â”‚  ğŸ‘¥ 3         â”‚  â”‚  ğŸ‘¥ 2         â”‚   â”‚
â”‚  â”‚  ğŸ§¹ 5m ago    â”‚  â”‚               â”‚  â”‚  â±ï¸ 35m ğŸŸ¡    â”‚  â”‚  â±ï¸ 10m ğŸŸ¢    â”‚   â”‚
â”‚  â”‚               â”‚  â”‚               â”‚  â”‚  ğŸ”” Help req  â”‚  â”‚  ğŸ“‹ 1 order   â”‚   â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚
â”‚                                                                                 â”‚
â”‚  WAITER TABLE CARD INFO (STANDARD):                                            â”‚
â”‚  â€¢ Table number                                                                â”‚
â”‚  â€¢ Status (color coded)                                                        â”‚
â”‚  â€¢ Guest count (if occupied)                                                   â”‚
â”‚  â€¢ Duration (with color coding)                                                â”‚
â”‚  â€¢ Order count OR bill amount (if bill requested)                             â”‚
â”‚  â€¢ Alert indicator (if needs attention)                                        â”‚
â”‚                                                                                 â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### 8.2 Manager Dashboard (Detailed View)

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  ğŸ‘” Krishna (Manager)                         ğŸ”” 5     âš™ï¸    [Logout]          â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                                                 â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”              â”‚
â”‚  â”‚ Today's â”‚  â”‚ Active  â”‚  â”‚ Pending â”‚  â”‚ Avg     â”‚  â”‚ Alerts  â”‚              â”‚
â”‚  â”‚ Sales   â”‚  â”‚ Tables  â”‚  â”‚ Orders  â”‚  â”‚ Time    â”‚  â”‚         â”‚              â”‚
â”‚  â”‚ Rs.45K  â”‚  â”‚  12/20  â”‚  â”‚   3     â”‚  â”‚  42m    â”‚  â”‚   2     â”‚              â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜              â”‚
â”‚                                                                                 â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚  FLOOR OVERVIEW                                           [Map View] [List]    â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                                                 â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚
â”‚  â”‚  Table 2 (Detailed)                                          [Expand â†—]  â”‚ â”‚
â”‚  â”‚  â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ â”‚ â”‚
â”‚  â”‚  Status: ğŸŸ¡ OCCUPIED          Waiter: Ram                                â”‚ â”‚
â”‚  â”‚  Guests: 4                    Duration: 25m ğŸŸ¢                           â”‚ â”‚
â”‚  â”‚                                                                           â”‚ â”‚
â”‚  â”‚  ORDERS:                                                                  â”‚ â”‚
â”‚  â”‚  #ORD-0042 â€¢ 3:02 PM â€¢ 5 items â€¢ Rs.1,200 â€¢ Status: SERVING             â”‚ â”‚
â”‚  â”‚    â””â”€ 2/5 items served                                                   â”‚ â”‚
â”‚  â”‚  #ORD-0045 â€¢ 3:18 PM â€¢ 2 items â€¢ Rs.350 â€¢ Status: PREPARING             â”‚ â”‚
â”‚  â”‚    â””â”€ 0/2 items served                                                   â”‚ â”‚
â”‚  â”‚                                                                           â”‚ â”‚
â”‚  â”‚  TIMELINE:                                                                â”‚ â”‚
â”‚  â”‚  3:00 PM - Session started (Guest count: 4)                              â”‚ â”‚
â”‚  â”‚  3:02 PM - Order #ORD-0042 placed                                        â”‚ â”‚
â”‚  â”‚  3:05 PM - Order confirmed                                               â”‚ â”‚
â”‚  â”‚  3:15 PM - 2 items served                                                â”‚ â”‚
â”‚  â”‚  3:18 PM - Additional order #ORD-0045                                    â”‚ â”‚
â”‚  â”‚                                                                           â”‚ â”‚
â”‚  â”‚  Est. Bill: Rs.1,550 (before tax)                                        â”‚ â”‚
â”‚  â”‚                                                                           â”‚ â”‚
â”‚  â”‚  [ View Full Details ]  [ Chat with Waiter ]  [ Request Bill ]           â”‚ â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚
â”‚                                                                                 â”‚
â”‚  MANAGER TABLE CARD INFO (DETAILED):                                           â”‚
â”‚  â€¢ Everything in Standard view PLUS:                                           â”‚
â”‚  â€¢ Assigned waiter name                                                        â”‚
â”‚  â€¢ All orders with status                                                      â”‚
â”‚  â€¢ Items served count                                                          â”‚
â”‚  â€¢ Session timeline                                                            â”‚
â”‚  â€¢ Estimated bill amount                                                       â”‚
â”‚  â€¢ Quick actions (view details, chat, request bill)                           â”‚
â”‚                                                                                 â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚  âš ï¸ ALERTS                                                                     â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚  ğŸ”´ Table 12 - Occupied 2h+ (Check on guests)              [ Dismiss ] [View] â”‚
â”‚  ğŸŸ¡ Table 5 - Waiting for cleaning (10 min)                [ Dismiss ] [View] â”‚
â”‚                                                                                 â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## 9. Database Schema Updates

### 9.1 Complete Schema Additions

```prisma
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
// TABLE SCHEMA UPDATE
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

model Table {
  id                  String        @id @default(cuid())
  restaurant_id       String
  
  // Basic Info
  table_number        String
  name                String?
  capacity            Int
  floor               String?       @default("Ground")
  section             String?
  
  // QR & OTP
  qr_code             String?       @unique
  current_otp         String
  otp_generated_at    DateTime      @default(now())
  
  // Position (for floor plan)
  position_x          Int?
  position_y          Int?
  
  // Status
  status              TableStatus   @default(AVAILABLE)
  
  // Timestamps
  created_at          DateTime      @default(now())
  updated_at          DateTime      @updatedAt
  
  // Relations
  restaurant          Restaurant    @relation(...)
  sessions            TableSession[]
  otp_history         OTPHistory[]
  qr_scan_events      QRScanEvent[]
  cleaning_records    TableCleaningRecord[]
  
  @@unique([restaurant_id, table_number])
  @@index([restaurant_id, status])
}

enum TableStatus {
  AVAILABLE         // Ready for guests
  OCCUPIED          // Has active session
  RESERVED          // Reserved for future
  BILL_REQUESTED    // Guest requested bill
  CLEANING          // Being cleaned
  BLOCKED           // Temporarily unavailable
  NEEDS_ATTENTION   // Guest requested help
}


// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
// SETTINGS SCHEMA
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

model RestaurantSettings {
  id                  String    @id @default(cuid())
  restaurant_id       String    @unique
  
  // â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
  // GUEST ASSISTANCE SETTINGS
  // â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
  assistance_enabled          Boolean   @default(true)
  otp_help_timer_minutes      Int       @default(2)     // Notify if no OTP in X min
  order_help_timer_minutes    Int       @default(5)     // Notify if no order in X min
  
  // â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
  // TABLE DURATION SETTINGS
  // â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
  duration_green_max          Int       @default(30)    // Minutes
  duration_yellow_max         Int       @default(60)    // Minutes
  duration_orange_max         Int       @default(90)    // Minutes
  // After orange_max = Red
  
  // â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
  // LONG STAY ALERTS
  // â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
  long_stay_alert_enabled     Boolean   @default(true)
  long_stay_alert_minutes     Int       @default(90)    // First alert after X min
  long_stay_repeat_minutes    Int       @default(30)    // Repeat every X min
  long_stay_notify_waiter     Boolean   @default(true)
  long_stay_notify_manager    Boolean   @default(true)
  
  // â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
  // CLEANING SETTINGS
  // â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
  cleaning_alert_enabled      Boolean   @default(true)
  cleaning_alert_minutes      Int       @default(10)    // Alert if not cleaned in X min
  cleaning_checklist_enabled  Boolean   @default(false)
  cleaning_checklist_items    Json?     // ["Table wiped", "Chairs arranged", ...]
  
  // Relations
  restaurant        Restaurant  @relation(...)
}
```

---

## 10. API Endpoints

### 10.1 QR Scan & Assistance APIs

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                           QR SCAN & ASSISTANCE APIs                             â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                                                 â”‚
â”‚  POST /api/guest/qr-scan                                                       â”‚
â”‚  â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€  â”‚
â”‚  Triggered when guest scans QR code (page load)                                â”‚
â”‚                                                                                 â”‚
â”‚  Request:                                                                       â”‚
â”‚  {                                                                              â”‚
â”‚    "table_id": "tbl_xxx",                                                      â”‚
â”‚    "device_fingerprint": "abc123",                                             â”‚
â”‚    "user_agent": "Mozilla/5.0..."                                              â”‚
â”‚  }                                                                              â”‚
â”‚                                                                                 â”‚
â”‚  Response:                                                                      â”‚
â”‚  {                                                                              â”‚
â”‚    "table": { "number": "5", "name": "Window Seat" },                         â”‚
â”‚    "restaurant": { "name": "QR Dine Restaurant", "logo": "..." },             â”‚
â”‚    "requires_otp": true,                                                       â”‚
â”‚    "scan_event_id": "scan_xxx"                                                 â”‚
â”‚  }                                                                              â”‚
â”‚                                                                                 â”‚
â”‚  POST /api/guest/verify-otp                                                    â”‚
â”‚  â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€  â”‚
â”‚  Verify OTP and start/join session                                             â”‚
â”‚                                                                                 â”‚
â”‚  Request:                                                                       â”‚
â”‚  {                                                                              â”‚
â”‚    "table_id": "tbl_xxx",                                                      â”‚
â”‚    "otp": "523",                                                               â”‚
â”‚    "scan_event_id": "scan_xxx"                                                 â”‚
â”‚  }                                                                              â”‚
â”‚                                                                                 â”‚
â”‚  Response (Success):                                                            â”‚
â”‚  {                                                                              â”‚
â”‚    "success": true,                                                            â”‚
â”‚    "session": {                                                                â”‚
â”‚      "id": "sess_xxx",                                                         â”‚
â”‚      "status": "CREATED",                                                      â”‚
â”‚      "guest_count": null  // Not set yet                                       â”‚
â”‚    },                                                                          â”‚
â”‚    "guest_token": "jwt_token_xxx"                                              â”‚
â”‚  }                                                                              â”‚
â”‚                                                                                 â”‚
â”‚  Response (Wrong OTP):                                                          â”‚
â”‚  {                                                                              â”‚
â”‚    "success": false,                                                           â”‚
â”‚    "error": "INVALID_OTP",                                                     â”‚
â”‚    "attempts": 2,                                                              â”‚
â”‚    "max_attempts": 5                                                           â”‚
â”‚  }                                                                              â”‚
â”‚                                                                                 â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### 10.2 Session APIs

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                              SESSION APIs                                       â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                                                 â”‚
â”‚  POST /api/sessions/:id/guest-count  (STAFF ONLY)                              â”‚
â”‚  â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€  â”‚
â”‚  Set/update guest count for session                                            â”‚
â”‚                                                                                 â”‚
â”‚  Request:                                                                       â”‚
â”‚  {                                                                              â”‚
â”‚    "guest_count": 4,                                                           â”‚
â”‚    "reason": "Initial"  // or "Guest added", "Guest left"                      â”‚
â”‚  }                                                                              â”‚
â”‚                                                                                 â”‚
â”‚  POST /api/sessions/:id/end  (STAFF ONLY)                                      â”‚
â”‚  â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€  â”‚
â”‚  End session after payment                                                      â”‚
â”‚                                                                                 â”‚
â”‚  Actions performed:                                                             â”‚
â”‚  - Session status â†’ COMPLETED                                                  â”‚
â”‚  - Table status â†’ CLEANING                                                     â”‚
â”‚  - Generate new OTP                                                            â”‚
â”‚  - Delete voice messages                                                       â”‚
â”‚  - Send cleaning notification                                                  â”‚
â”‚                                                                                 â”‚
â”‚  GET /api/sessions/:id/timeline                                                â”‚
â”‚  â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€  â”‚
â”‚  Get complete session timeline                                                  â”‚
â”‚                                                                                 â”‚
â”‚  Response:                                                                      â”‚
â”‚  {                                                                              â”‚
â”‚    "session": { ... },                                                         â”‚
â”‚    "timeline": [                                                               â”‚
â”‚      { "time": "3:00 PM", "event": "Session started", "by": "System" },       â”‚
â”‚      { "time": "3:00 PM", "event": "Guest count: 4", "by": "Ram (Waiter)" },  â”‚
â”‚      { "time": "3:02 PM", "event": "Order #ORD-0042 placed", "by": "Guest" }, â”‚
â”‚      { "time": "3:03 PM", "event": "Order confirmed", "by": "Ram" },          â”‚
â”‚      ...                                                                       â”‚
â”‚    ]                                                                           â”‚
â”‚  }                                                                              â”‚
â”‚                                                                                 â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### 10.3 Order Item Status APIs

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                          ORDER ITEM STATUS APIs                                 â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                                                 â”‚
â”‚  PATCH /api/orders/:orderId/items/:itemId/status                               â”‚
â”‚  â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€  â”‚
â”‚  Update item status with timestamp                                              â”‚
â”‚                                                                                 â”‚
â”‚  Request:                                                                       â”‚
â”‚  {                                                                              â”‚
â”‚    "status": "PREPARING"  // or "READY", "SERVED"                              â”‚
â”‚  }                                                                              â”‚
â”‚                                                                                 â”‚
â”‚  System automatically sets:                                                     â”‚
â”‚  - preparing_at / ready_at / served_at = NOW()                                 â”‚
â”‚  - preparing_by / ready_by / served_by = current_staff_id                      â”‚
â”‚                                                                                 â”‚
â”‚  POST /api/orders/:orderId/items/bulk-serve  (WAITER)                          â”‚
â”‚  â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€  â”‚
â”‚  Mark multiple items as served at once                                          â”‚
â”‚                                                                                 â”‚
â”‚  Request:                                                                       â”‚
â”‚  {                                                                              â”‚
â”‚    "item_ids": ["item_1", "item_2", "item_3"]                                  â”‚
â”‚  }                                                                              â”‚
â”‚                                                                                 â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### 10.4 Table Cleaning APIs

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                          TABLE CLEANING APIs                                    â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                                                 â”‚
â”‚  POST /api/tables/:id/mark-cleaned  (ANY STAFF)                                â”‚
â”‚  â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€  â”‚
â”‚  Mark table as cleaned and available                                            â”‚
â”‚                                                                                 â”‚
â”‚  Request:                                                                       â”‚
â”‚  {                                                                              â”‚
â”‚    "checklist": {          // Optional, if enabled                             â”‚
â”‚      "table_wiped": true,                                                      â”‚
â”‚      "chairs_arranged": true,                                                  â”‚
â”‚      "floor_checked": true,                                                    â”‚
â”‚      "condiments_restocked": true                                              â”‚
â”‚    }                                                                           â”‚
â”‚  }                                                                              â”‚
â”‚                                                                                 â”‚
â”‚  Actions performed:                                                             â”‚
â”‚  - Table status â†’ AVAILABLE                                                    â”‚
â”‚  - Create TableCleaningRecord                                                  â”‚
â”‚  - Cancel any cleaning alerts                                                  â”‚
â”‚                                                                                 â”‚
â”‚  GET /api/tables/cleaning-queue                                                â”‚
â”‚  â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€  â”‚
â”‚  Get all tables waiting for cleaning                                            â”‚
â”‚                                                                                 â”‚
â”‚  Response:                                                                      â”‚
â”‚  {                                                                              â”‚
â”‚    "tables": [                                                                 â”‚
â”‚      {                                                                         â”‚
â”‚        "id": "tbl_xxx",                                                        â”‚
â”‚        "table_number": "5",                                                    â”‚
â”‚        "cleaning_requested_at": "2026-01-25T16:05:00Z",                       â”‚
â”‚        "waiting_minutes": 8,                                                   â”‚
â”‚        "previous_session": {                                                   â”‚
â”‚          "guest_count": 4,                                                     â”‚
â”‚          "duration_minutes": 65,                                               â”‚
â”‚          "total_amount": 1492                                                  â”‚
â”‚        }                                                                       â”‚
â”‚      }                                                                         â”‚
â”‚    ]                                                                           â”‚
â”‚  }                                                                              â”‚
â”‚                                                                                 â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## 11. Notification Templates

### 11.1 All Notification Types

| Type | Recipients | Message Template | Priority |
|------|------------|------------------|----------|
| `GUEST_NEEDS_OTP_HELP` | Assigned waiter, All waiters | "Table {N} - Guest scanned QR but hasn't entered OTP ({X} min ago)" | MEDIUM |
| `GUEST_BROWSING_NO_ORDER` | Assigned waiter | "Table {N} - Guest browsing menu, may need assistance" | LOW |
| `GUEST_OTP_FAILED` | Assigned waiter, Manager | "Table {N} - Guest entered wrong OTP {X} times" | HIGH |
| `TABLE_READY_FOR_CLEANING` | Assigned waiter, All waiters | "Table {N} - Ready for cleaning (Session: {duration}, Bill: Rs.{amount})" | MEDIUM |
| `CLEANING_OVERDUE` | Manager, All waiters | "Table {N} - Waiting for cleaning ({X} min)" | HIGH |
| `LONG_STAY_ALERT` | Assigned waiter, Manager | "Table {N} - Occupied for {duration} - Check if assistance needed" | LOW |
| `NEW_ORDER` | Kitchen | "New order #{N} from Table {T}" | HIGH |
| `ORDER_READY` | Assigned waiter | "Order #{N} ready for pickup - Table {T}" | HIGH |
| `BILL_REQUESTED` | Cashier, Assigned waiter | "Table {N} requesting bill" | HIGH |
| `VOICE_MESSAGE` | Assigned waiter | "Voice message from Table {N}" | HIGH |

---

## 12. Settings & Configuration

### 12.1 Configurable Settings UI

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  âš™ï¸ SETTINGS â†’ TABLE MANAGEMENT                                                â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                                                 â”‚
â”‚  â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•   â”‚
â”‚  GUEST ASSISTANCE ALERTS                                          [Enabled âœ“]  â”‚
â”‚  â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•   â”‚
â”‚                                                                                 â”‚
â”‚  Notify if guest hasn't entered OTP after:      [ 2 ] minutes                  â”‚
â”‚  Notify if guest browsing but hasn't ordered:   [ 5 ] minutes                  â”‚
â”‚                                                                                 â”‚
â”‚  Send notifications to:                                                        â”‚
â”‚  â˜‘ Assigned waiter                                                             â”‚
â”‚  â˜ All waiters                                                                 â”‚
â”‚  â˜ Manager                                                                     â”‚
â”‚                                                                                 â”‚
â”‚  â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•   â”‚
â”‚  TABLE DURATION COLORS                                                         â”‚
â”‚  â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•   â”‚
â”‚                                                                                 â”‚
â”‚  ğŸŸ¢ Green (Normal):     0 - [ 30 ] minutes                                     â”‚
â”‚  ğŸŸ¡ Yellow (Long):      [ 30 ] - [ 60 ] minutes                                â”‚
â”‚  ğŸŸ  Orange (Very Long): [ 60 ] - [ 90 ] minutes                                â”‚
â”‚  ğŸ”´ Red (Extended):     [ 90 ]+ minutes                                        â”‚
â”‚                                                                                 â”‚
â”‚  â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•   â”‚
â”‚  LONG STAY ALERTS                                                 [Enabled âœ“]  â”‚
â”‚  â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•   â”‚
â”‚                                                                                 â”‚
â”‚  Send first alert after table occupied for:     [ 90 ] minutes                 â”‚
â”‚  Repeat alert every:                            [ 30 ] minutes                 â”‚
â”‚                                                                                 â”‚
â”‚  Send notifications to:                                                        â”‚
â”‚  â˜‘ Assigned waiter                                                             â”‚
â”‚  â˜‘ Manager                                                                     â”‚
â”‚                                                                                 â”‚
â”‚  â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•   â”‚
â”‚  TABLE CLEANING                                                   [Enabled âœ“]  â”‚
â”‚  â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•   â”‚
â”‚                                                                                 â”‚
â”‚  Alert if table not cleaned within:             [ 10 ] minutes                 â”‚
â”‚                                                                                 â”‚
â”‚  Cleaning checklist:                                              [Enabled â˜]  â”‚
â”‚  (If enabled, staff must confirm checklist items before marking cleaned)       â”‚
â”‚                                                                                 â”‚
â”‚                                        [ Cancel ]    [ Save Settings ]          â”‚
â”‚                                                                                 â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## Summary of Decisions Implemented

| # | Decision | Implementation |
|---|----------|----------------|
| Q1 | Track QR scan on page load | âœ… POST /api/guest/qr-scan creates QRScanEvent |
| Q2 | Different messages per case | âœ… 3 notification types with specific messages |
| Q3 | Configurable timers | âœ… RestaurantSettings with all timer fields |
| Q4 | Waiter marks "Served" | âœ… OrderItem.served_at + served_by fields |
| Q5 | Bill shows "Served at" only | âœ… Internal view shows order#, customer bill shows served time only |
| Q6 | OTP changes on payment | âœ… endSessionAndChangeOTP() function |
| Q7 | Keep OTP history | âœ… OTPHistory model with full tracking |
| Q8 | Any staff can mark cleaned | âœ… POST /api/tables/:id/mark-cleaned (any staff) |
| Q9 | Cleaning time limit alert | âœ… cleaning_alert_minutes setting + CLEANING_OVERDUE notification |
| Q10 | Color + configurable alert | âœ… Duration colors + long_stay_alert settings |
| Q11 | Standard for waiter, Detailed for manager | âœ… Different dashboard views documented |

---

## Files to Create/Modify

### New Files:
```
/packages/database/prisma/schema.prisma (updates)
/apps/web/lib/services/qr-scan.service.ts
/apps/web/lib/services/session.service.ts (updates)
/apps/web/lib/services/otp.service.ts
/apps/web/lib/services/cleaning.service.ts
/apps/web/lib/services/assistance-timer.service.ts
/apps/web/lib/jobs/assistance-check.job.ts
/apps/web/lib/jobs/long-stay-check.job.ts
/apps/web/lib/jobs/cleaning-alert.job.ts
/apps/web/app/(dashboard)/settings/tables/page.tsx
/apps/web/app/(dashboard)/waiter/components/TableCard.tsx (updates)
/apps/web/app/(dashboard)/manager/components/TableCardDetailed.tsx
/apps/web/app/api/guest/qr-scan/route.ts
/apps/web/app/api/sessions/[id]/end/route.ts
/apps/web/app/api/tables/[id]/mark-cleaned/route.ts
```

---

## End of Session Flow Specification
